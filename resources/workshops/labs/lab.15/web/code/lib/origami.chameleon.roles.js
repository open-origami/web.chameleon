const e="object",t="array",n="function",r="number",o="boolean",i="string",u="undefined",c=".",f=void 0;let s=e=>t=>typeof e[t]!==n,l=e=>t=>typeof e[t]===n,a=e=>e=>"constructor"!==e;function g(g){function p(e){if((e=typeof e===u?g:e)===Object.prototype||e===Array.prototype||e===Function.prototype||e===String.prototype||e===Number.prototype||e===Boolean.prototype||null===e)return[];return[...p(Object.getPrototypeOf(e)),...Object.getOwnPropertyNames(e)].filter((function(e,t,n){return t<=n.indexOf(e)}))}function d(e){return e?e.split(c).reduce((function(e,t){return Array.isArray(e)&&isNaN(t)?e.map((function(e){return e[t]})):e&&e[t]}),g):g}function y(e){const n=d(e);return n instanceof Array?t:typeof n}function h(e){return y(e)===n}function b(e){return y(e)===t}function v(t){return y(t)===e}function m(e){return y(e)===u}function O(e,t){return p().reduce((function(t,n,r){return e(t,g[n],n,g)}),t)}return g=g||{},{at:function(e){if(p().length>e){const t=p()[e];return{key:t,value:d(t)}}},get keys(){return p()},get properties(){return p(g).filter(s(g))},get methods(){return p(g).filter(l(g)).filter(a())},get prototype(){return Object.getPrototypeOf(g)},get:d,set:function(e,t){return e.split(c).reduce((function(e,n,r,o){return e[n]=r<o.length-1?e[n]||{}:t}),g)},has:function(e){return!m(e)},remove:function(e){return e.split(c).reduce((function(e,t,n,r){return n<r.length-1?e?e[t]:f:e&&delete e[t]}),g)},type:y,isFunction:h,isArray:b,isObject:v,isNumber:function(e){return y(e)===r},isBoolean:function(e){return y(e)===o},isString:function(e){return y(e)===i},isPrimitive:function(e){return!(m(e)||v(e)||b(e)||h(e))},isUndefined:m,asArray:function(e){return b(e)?d(e):[d(e)]},asFunction:function(e){return h(e)?d(e):function(){return d(e)}},forEach:function(e){p().forEach((function(t,n){e(g[t],t,g)}))},map:function(e){return O((function(t,n,r){return t[r]=e(n),t}),{})},reduce:O,filter:function(e){return O((function(t,n,r){return e(n)&&(t[r]=n),t}),{})},every:function(e){return O((function(t,n,r){return t&&e(n)}),!0)},some:function(e){return O((function(t,n,r){return t||e(n)}),!1)}}}const p="before",d="after",y="around",h="provided",b="except",v=void 0;function m(e){function t(e){if(e.advisable)return e;const t=function(...n){let r=v;return t.provided.every(e=>e(...n))&&(t.except.some(e=>e(...n))||(r=t.before.reduce((e,t)=>t(...n,e),r),r=t.around.reduce((t,r)=>r(e,...n,t),r),0===t.around.length&&(r=e(...n)),r=t.after.reduce((e,t)=>t(...n,e),r)||r)),r};return t.provided=t.provided||[],t.except=t.except||[],t.before=t.before||[],t.after=t.after||[],t.around=t.around||[],t.advisable=!0,t}function n(t){return function(n){return e.advisable&&(e[t]=e[t].filter((function(e){return e!==n}))),e}}function r(t,n){return n=n||e,function(...e){let r=n(...e);return r===v?r:t(r)}}function o(t){return function(...n){setTimeout((function(){e(...n)}),t||0)}}return e=e||function(){},{fix:function(t){return function(...n){return e.apply(this,n.splice(0,t))}},first:function(...t){return function(...n){return e(...t,...n)}},last:function(...t){return function(...n){return e(...n,...t)}},lCurry:function(){return function t(...n){return n.length>=e.length?e(...n):function(...e){return t(...n,...e)}}()},rCurry:function(){return function t(...n){return n.length>=e.length?e(...n):function(...e){return t(...e,...n)}}()},before:function(n){return(e=t(e)).before.push(n),e},after:function(n){return(e=t(e)).after.push(n),e},around:function(n){return(e=t(e)).around.push(n),e},provided:function(n){return(e=t(e)).provided.push(n),e},except:function(n){return(e=t(e)).except.push(n),e},not:{before:n(p),after:n(d),around:n(y),provided:n(h),except:n(b)},composeWith:r,sequenceWith:function(...e){return e.reduce((function(e,t){return r(t,e)}),e=>e)},fluent:function(t,n){let r=n||function(){};return function(...n){return r(e(...n)),t}},memoize:function(){let t={};return function(...n){return n in t?t[n]:t[n]=e(...n)}},overload:function(...e){return function(...t){return(e.filter((function(e){return e.length===t.length}))[0]||(e=>e))(...t)}},delay:o,forever:function(t){return function(...n){return setInterval((function(){e(...n)}),t||0)}},retry:function(e,t){return function(...e){o(t)(...e)}},defer:function(){return o(0)}}}const O=void 0;function P(e){let t=g(e=(e=e||{}).prototype?e.prototype:e);function n(n,r){return t.isFunction(n)&&(e[n]=e[n].bind(r)),this}function r(t,n){return e[t]=n,this}function o(t){return delete e[t],this}function i(e,t){return t in e&&r(t,e[t]),this}function u(e,t){return i(e,t),P(e).remove(t),this}function c(){return P(Object.getPrototypeOf(e))}function f(t){return Object.getOwnPropertyDescriptor(e,t)}function s(t,n){return function(r,o){return e[r]=m(e[r]).not[t](o),n}}let l={get:function(){return e},bind:n,context:function(t){return g(e).keys.forEach((function(e){n(e,t)})),this},add:r,remove:o,update:function(t,n){return t in e&&r(t,n),this},rename:function(t,n){return t in e&&!(n in e)&&(r(n,e[t]),o(t)),this},copy:i,move:u,mix:function(e,t,r){g(e);const o=r||(e=>e);return g(e).keys.filter(o).filter(e=>"constructor"!==e).forEach((function(r){i(e,r),t&&n(r,t)})),this},clone:function(){return P(Object.assign({},e))},create:function(){return Object.create(e)},copyUp:function(t){return P(c().get()).copy(e,t),this},copyDown:function(e){return i(c().get(),e),this},moveUp:function(t){return P(c().get()).move(e,t),this},moveDown:function(e){return u(c().get(),e),this},prototype:function(t){return t==O?c():function(t){return t=t.prototype?t.prototype:t,Object.setPrototypeOf(e,t),P(e)}(t)},before:function(n,r){return t.isFunction(n)?e[n]=m(e[n]).before(r):function(t,n){n.get=n.get||function(){},n.set=n.set||function(){};let r=f(t);Object.defineProperty(e,t,{get:function(){return n.get(),r.get()},set:function(e){n.set(e),r.set(e)}})}(n,r),this},after:function(n,r){return t.isFunction(n)?e[n]=m(e[n]).after(r):function(t,n){n.get=n.get||function(){},n.set=n.set||function(){};let r=f(t);Object.defineProperty(e,t,{get:function(){let e=n.get();return r.get(),e},set:function(e){r.set(e),n.set(e)}})}(n,r),this},around:function(t,n){return e[t]=m(e[t]).around(n),this},provided:function(t,n){return e[t]=m(e[t]).provided(n),this},except:function(t,n){return e[t]=m(e[t]).except(n),this},property:function(t,n){return n?(function(t,n){Object.defineProperty(e,t,n)}(t,n),this):f(t)},delegate:function(t,n){return e[t]=function(...r){let o=n[t].call(e,...r);return o===n?this:o},this},forward:function(t,n){return e[t]=function(...e){let r=n[t].call(n,...e);return r===n?this:r},this},fProxy:function(){let n={};return t.keys.forEach((function(r){t.isFunction(r)&&(n[r]=function(...t){let o=e[r](...t);return o===e?n:o})})),n},dProxy:function(n){let r={};return t.keys.forEach((function(o){t.isFunction(o)&&(r[o]=function(...t){let i=e[o].apply(n,t);return i===e?r:i})})),r},not:{}};return l.not.before=s("before",l),l.not.after=s("after",l),l.not.around=s("around",l),l.not.provided=s("provided",l),l.not.except=s("except",l),l}const w="get",j="set",k="add",L="remove";const x="get",E="set",C="remove";function D(e){let t={},n=function(e){let t=P(e),n=new WeakMap;function r(e){if(n.has(e))return n.get(e);{function t(...t){t.pop(),e(...t)}return n.set(e,t),t}}return{bind:function(e,n){let o=r(n);e===j?(t.after(k,o),t.after(j,o)):t.after(e,o)},unbind:function(n,o){let i=o&&r(o);n===j?(o&&t.not.after(k,i),o&&t.not.after(j,i),!o&&(e[k].after=[]),!o&&(e[j].after=[])):(o&&t.not.after(n,i),!o&&(e[n].after=[]))},reset:function(){e[w].after=[],e[j].after=[],e[k].after=[],e[L].after=[]}}}(e);return t.get=function(e){return n.bind(x,e),t},t.set=function(e){return n.bind(E,e),t},t.remove=function(e){return n.bind(C,e),t},t.reset=n.reset,t.not={},t.not.get=function(e){return n.unbind(x,e),t},t.not.set=function(e){return n.unbind(E,e),t},t.not.remove=function(e){return n.unbind(C,e),t},t}const{isArray:F}=Array;function S(){let e=window,t=(e.Origami=e.Origami||{},e.Origami.Whale=e.Origami.Whale||{},e.Origami.Whale.Store=e.Origami.Whale.Store||function(e){let t=new Map,n=e||new Map,r={config:function(e){return e.store&&(t=new Map(Object.entries(e.store))),e.parent&&(n=e.parent),this},get:function(e){let r=t.get(e),o=n.get(e);return r&&r||o&&o||r},set:function(e,n){return t.set(e,n),this},add:function(e,n){let r=t.get(e);return F(r)?t.set(e,[...r,n]):t.set(e,[n]),this},keys:function(){let e=new Set,r=t.keys(),o=n.keys();for(let t of o)e.add(t);for(let t of r)e.add(t);return[...e]},has:function(e,n){let r=t.get(e);return F(r)?r.includes(n):void 0!==r},remove:function(e,n){let r=e=>void 0!==e;return r(e)&&r(n)&&function(e,n){let r=t.get(e),o=F(r),i=o&&r.filter(e=>e!==n);o&&t.set(e,i)}(e,n),r(e)&&!r(n)&&function(e){t.delete(e)}(e),!r(e)&&!r(n)&&t.clear(),this}};return r.hooks=D(r),r}(),e.Origami.Whale.Store);return{get:function(e){return t.get(e)},set:function(e,n){t.set(e,n)},keys:function(){return t.keys()},remove:function(e){t.remove(e)}}}const M=function(){let e=S();return{key:function(t){return e.get(t)},keys:function(){return e.keys()},define:function(t){for(let n in t){let r=t[n];e.set(n,r)}return this},undefine:function(t){if(t)for(let n in t)e.remove(n);else e.remove();return this}}}();var W={"Logger.Labels.Debug":"[DEBUG]","Logger.Labels.Info":" [INFO]","Logger.Labels.Warn":" [WARN]","Logger.Labels.Error":"[ERROR]","Logger.Labels.Fatal":"[FATAL]","Logger.Levels.Debug":1,"Logger.Levels.Info":2,"Logger.Levels.Warn":3,"Logger.Levels.Error":4,"Logger.Levels.Fatal":5,"Logger.Config.Format":"@Label @Target @Prefix - @Message","Logger.Config.Prefix":"","Logger.Config.Level":3};var A={install:function(){M.define(W)},uninstall:function(){M.undefine(W)}};function I(e,t){return function(n,...r){let o=M.key("Logger.Config.Level");n>=(e.level||o)&&t(n,...r)}}const R=M.key("Logger.Labels.Debug"),N=M.key("Logger.Labels.Info"),T=M.key("Logger.Labels.Warn"),U=M.key("Logger.Labels.Error"),B=M.key("Logger.Labels.Fatal"),K="",q=" ",z=[R,N,T,U,B];function G(e,t){return function(n,...r){let o=M.key("Logger.Config.Format")||K,i=M.key("Logger.Config.Prefix")||K,u=(M.key("Logger.Config.Level"),e.level,r.join(q)),c=z[n-1],f=e.Key,s=o;s=(s=(s=(s=s.replace("@Label",c)).replace("@Prefix",i)).replace("@Target",f)).replace("@Message",u),t(n,s)}}const H=console;function J(e,t){return function(e,...n){H.log(...n),t(e,...n)}}function Q(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function V(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}const X=M.key("Logger.Levels.Debug"),Y=M.key("Logger.Levels.Info"),Z=M.key("Logger.Levels.Warn"),$=M.key("Logger.Levels.Error"),_=M.key("Logger.Levels.Fatal");function ee(e,t){let n=t||{},r=n.filters,o=function(e){let t=[];return{filter:function(e){return(0,Array.isArray)(e)&&(t=[...t,...e]),(e=>"function"==typeof e)(e)&&(t=[...t,e]),this},create:function(){let n=[...t].reverse(),r=function(){};return function(...t){return n.reduce((function(t,n){return n(e,t)}),r)(...t)}}}}(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Q(n,!0).forEach((function(t){V(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Q(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},n,{Key:e})).filter(I).filter(G).filter(J).filter(r).create();return{debug:function(...e){o(X,...e)},info:function(...e){o(Y,...e)},warn:function(...e){o(Z,...e)},fatal:function(...e){o(_,...e)},error:function(...e){o($,...e)}}}var te={"Core.Id":"Core.Id","Core.Family":"Core.Family","Core.Family.Component":"Component","Core.Family.Extension":"Extension","Core.Family.Model":"Model","Core.Extensions.Pending":"Core.Extensions.Pending","Core.Extensions.Installed":"Core.Extensions.Installed"},ne={"Extension.Model":"Extension.Model","Extension.Provider":"Extension.Provider"};const re="origami.chameleon",oe="Package successfully installed",ie="Package successfully uninstalled";var ue=function(){const e=ee(re);return{install:function(){M.define(te),M.define(ne),e.info(oe)},uninstall:function(){M.undefine(te),M.undefine(ne),e.info(ie)}}}(),ce={"Extension.Role.States":"Extension.Role.States"};const fe="origami.chameleon.roles",se="Package successfully installed",le="Package successfully uninstalled";var ae=function(){const e=ee(fe);return{install:function(){M.define(ce),e.info(se)},uninstall:function(){M.undefine(ce),e.info(le)}}}();A.install(),ue.install(),ae.install();const ge="function",pe="class";const{isFunction:de,isClass:ye,isProperty:he,isMethod:be,isDescriptor:ve}=function(){function e(e){return typeof e===ge}return{isFunction:e,isClass:function(e){return e.toString().startsWith(pe)},isProperty:function(e){return e&&(e.get||e.set)},isMethod:function(t){return t&&t.value&&e(t.value)},isDescriptor:function(e){return e&&(e.value||e.get||e.set)}}}();function me(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Oe(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?me(n,!0).forEach((function(t){Pe(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):me(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function Pe(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function we(e){return function(t,n,r){if(be(r)){let o=t.constructor,i=e(o,n,r),u=r;return de(i)&&(u=Oe({},u,{value:i})),ve(i)&&(u=Oe({},u,{},i)),Reflect.defineProperty(t,n,u),u}}}function je(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function ke(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}const{isArray:Le}=Array;function xe(e){let t={},n=g(t),r=g(e);let o={config:function(e){return r=e.parent||r,t=e.store||t,n=g(t),this},get:function(e){return n.has(e)?n.isObject(e)?function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?je(n,!0).forEach((function(t){ke(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):je(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},r.get(e),{},n.get(e)):n.get(e):r.get(e)},set:function(e,t){return n.set(e,t),this},add:function(e,t){let r=n.get(e);return Le(r)?n.set(e,[...r,t]):n.set(e,[t]),this},keys:function(e){let t=!!e,r=n.has(e);return t&&r?g(n.get(e)).keys:g(n.get()).keys},has:function(e,t){let r=n.get(e);return Le(r)?r.includes(t):void 0!==r},remove:function(e,t){let r=e=>void 0!==e;function o(e){n.remove(e)}return r(e)&&r(t)&&function(e,t){let r=n.get(e),o=Le(r),i=o&&r.filter(e=>e!==t);o&&n.set(e,i)}(e,t),r(e)&&!r(t)&&o(e),!r(e)&&!r(t)&&function(){let e=n.keys;for(let t of e)o(t)}(),this}};return o.hooks=D(o),o}const Ee="class",Ce="object";function De(e){function t(e){return e.toString().startsWith(Ee)}return{get object(){return function(e){return t(e)?e.prototype:e}(e)},get class(){return function(e){return t(e)?e:Reflect.getPrototypeOf(e).constructor}(e)},get isObject(){return function(e){return typeof e===Ce}(e)},get isClass(){return t(e)}}}const Fe=window;var Se=(Fe.Origami=Fe.Origami||{},Fe.Origami.Chameleon=Fe.Origami.Chameleon||{},Fe.Origami.Chameleon.Store=Fe.Origami.Chameleon.Store||new WeakMap,Fe.Origami.Chameleon.Store);function Me(e){return ze(e).registry}const We=M.key("Core.Extensions.Pending");let Ae=e=>De(e).isObject,Ie=e=>e;function Re(e){return function(t){return{install:function(n){if(Ae(t))e(t).install(n);else{Me(Ie(t)).add(We,n)}return this},uninstall:function(n){if(Ae(t))e(t).uninstall(n);else{Me(Ie(t)).remove(We,n)}return this}}}}const Ne=M.key("Core.Extensions.Installed");function Te(e){let t=Me(e);function n(e){let n=t.get(Ne)||[];return e?n.find((e=>t=>t.class===e)(e)):n}function r(e){return!!n(e)}return{create:function(o){if(r(o))return n(o);{let n=function(e){return{create:function(t){let n=new t(e),r=!0;return{get core(){return e},get class(){return t},get provider(){return n},isOn:()=>r,on(){r=!0},off(){r=!1}}}}}(e).create(o);return t.add(Ne,n),n}},get:n,has:r,remove:function(e){let r=n(e);r&&t.remove(Ne,r)}}}function Ue(e){return function(t){let n=function(e){return function(t){return Te(e).has(t)}}(t),r=e(t);return{install:function(e){return!n(e)&&r.install(e),this},uninstall:function(e){return n(e)&&r.uninstall(e),this}}}}function Be(e){return function(t){let n=Te(t),r=e(t);return{install:function(e){return n.create(e).provider.install(),r.install(e),this},uninstall:function(e){if(n.has(e)){n.get(e).provider.uninstall(),n.remove(e),r.uninstall(e)}return this}}}}const Ke=M.key("Extension.Provider");function qe(e){return function(t){let n=e(t);function r(e){return Me(e).has(Ke)}function o(e){return Me(e).get(Ke)}return{install:function(e){return r(e)&&(e=o(e)),!r(e)&&n.install(e),this},uninstall:function(e){return r(e)&&(e=o(e)),!r(e)&&n.uninstall(e),this}}}}function ze(e){return{get registry(){return function(e){let t=De(e).object,n=Se.get(t)||xe();return Se.set(t,n),n}(e)},get core(){return{get type(){return{}},get dom(){return{}},get reactive(){return{}},get style(){return{}}}},get extensions(){return function(e){let t=function(e){let t=[];return{filter:function(e){return e&&t.push(e),this},create:function(){return[...t].reverse().reduce((function(e,t){return t(e)}),(function(e){return{install(){return this},uninstall(){return this}}}))(e)}}}(e).filter(Re).filter(qe).filter(Ue).filter(Be).create();return{install:function(e){return t.install(e),this},uninstall:function(e){return t.uninstall(e),this}}}(e)}}}function Ge(e){return ze(e).registry}function He(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Je(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}const Qe=M.key("Extension.Role.States");let Ve=e=>({key:t})=>e===t,Xe=e=>({key:t})=>e!==t;function Ye(e){let t=Ge(e);function n(e){let n=t.get(Qe)||[];return e?n.find(Ve(e)):n}function r(n,r){let o=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?He(n,!0).forEach((function(t){Je(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):He(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},{key:n,begin:!1,end:!1,guards:[],routes:[],action:e.prototype[n]},{},r||{});return t.add(Qe,o),o}return{create:r,get:n,set:r,has:function(e){return!!n(e)},remove:function(e){let n=(t.get(Qe)||[]).filter(Xe(e));t.set(Qe,n)}}}const Ze=we((function(e,t){let n=Ye(e);!n.get(t)&&n.create(t)})),$e=we((function(e,t){let n=Ye(e);(n.get(t)||n.create(t)).begin=!0}));function _e(e){return we((function(t,n){let r=Ye(t);(r.get(n)||r.create(n)).guards.push(e)}))}function et(e,t){return we((function(n,r){let o=Ye(n),i=(o.get(r)||o.create(r)).routes;t&&i.push({to:e,guard:t}),!t&&i.push({to:e})}))}const tt=we((function(e,t){let n=Ye(e);(n.get(t)||n.create(t)).end=!0}));const nt=M.key("Core.Id"),rt=M.key("Core.Family"),ot=M.key("Core.Family.Model"),it=(ut=function(e){let t=e.name,n=ot;Me(e).set(nt,t).set(rt,n)},function(e){return ut(e)});var ut;const ct=M.key("Core.Extensions.Installed");let ft=new Map;function st(e){let t=function(e){let t=ft.get(e)||new Map;return ft.set(e,t),t}(e);function n(e){if(e)return[...t.get(e)||[]];{let e={};for(let[n,r]of t)e[n]=[...r];return e}}return{get:n,set:function(e,n){let r=t.get(e)||new Set;r.add(n),t.set(e,r)},has:function(e,t){return t&&n(e).includes(t)||!t&&n(e).length>0},remove:function(e,n){e&&n&&t.get(e)&&t.get(e).delete(n),e&&!n&&t.delete(e),!e&&!n&&t.clear()}}}function lt(e){let t=st(e),n={};return{wait:function(e){return new Promise(r=>{n[e]=n[e]||[],n[e].push(r),t.set(e,this)})},signal:function(e){let r=n[e]||[];for(let t of r)t(e);t.remove(e,this)}}}function at(e){return function(t){let n=t.map(function(e){return function(t){let n=lt(e);return{wait:function(){return n.wait(t)}}}}(e));return{wait:function(){let e=[];for(let t of n){let n=t.wait();e.push(n)}return Promise.all(e)}}}}let gt=e=>!!e.length;function pt(e){return function(t){let n=t.map(function(e){return function({guard:t,to:n}){let r=lt(e);return{wait:async function(){return t&&await r.wait(t),n}}}}(e));return{wait:function(){if(gt(n)){let e=[];for(let t of n){let n=t.wait();e.push(n)}return Promise.race(e)}return Promise.resolve()}}}}let dt=e=>!0,yt=e=>{};let ht=e=>e.provider.class,bt=e=>e.provider.ext,vt=e=>e.isOn,mt=e=>e.begin,Ot=e=>t=>t.name===e,Pt=e=>Ye(e).get(),wt=e=>!e||e.end&&!!e.end;function jt(e){let t,n,r,o,i,u,c={};function f(){var f;t=ht(e),n=Pt(t).map((f=c,function(e){let t=e.key,n=e.begin||!1,r=e.end||!1,o=e.action||yt,i=e.guards||[],u=e.routes||[],c=at(f)(i),s=pt(f)(u);return{name:t,begin:n,end:r,guards:i,routes:u,execute:async function(e,t=dt){return await c.wait(),t()&&await o.call(e),s.wait()}}})),r=n.find(mt),i=vt(e),u=bt(e),o=!1}function s(){return r&&i()&&!o}function l(){o=!0}return f(),c.states=n,c.state=r,c.init=f,c.start=async function(){let e;for(o=!1;s();)e=await r.execute(u,s),wt(r)&&l(),wt(e)&&l(),r=e&&n.find(Ot(e))},c.started=s,c.stop=l,c.destroy=function(){l(),f()},c}let kt=e=>e.guards,Lt=e=>e.routes.filter(Et).map(xt),xt=e=>e.guard,Et=e=>!!e.guard;function Ct(e){return function(t){let n=[];function r(){return e.addEventListener&&e.removeEventListener}return{check:r,start:function(){if(r()){let r=function(e){let t=e.states,n=new Set;for(let e of t){let t=kt(e),r=Lt(e);for(let e of t)n.add(e);for(let e of r)n.add(e)}return n}(t);for(let i of r){function o(){let e=st(t).get(i);for(let t of e)t.signal(i)}e.addEventListener(i,o),n.push({signal:i,handler:o})}}},stop:function(){if(r())for(let t of n){let{signal:n}=t,{handler:r}=t;e.removeEventListener(n,r)}}}}}function Dt(e){let t=function(e){return function(t){let n=Ge(e).get(ct)||[];return t?n.find((e=>t=>t.provider.ext===e)(t)):n}}(e),n=Ct(e);return{create:function(e){let r=t(e),o=jt(r),i=n(o);r.role={},r.role.locus=e,r.role.lCycle=o,r.role.engine=i,r.role.lCycle.start(),r.role.engine.start(),r.on()},destroy:function(e){let n=t(e);n.role.lCycle.stop(),n.role.engine.stop(),n.off()}}}var Ft;let St=ee("origami.chameleon.roles"),Mt=it(Ft=class{constructor(e){this.role=Dt(e)}install(e){this.role.create(e),St.info("Extension successfully installed")}uninstall(e){this.role.destroy(e),St.info("Extension successfully uninstalled")}})||Ft;export{$e as Begin,tt as End,_e as Guard,Mt as Role,et as Route,Ze as State};